# コードレビューガイドライン

コードレビューを依頼された場合は、以下のガイドラインに従って実施してください。

## レビュースタンス

- **実用性重視**: 教科書的な「正解」より、プロジェクトの文脈に合った改善案を提案する
- **Linting は指摘しない**: Prettier・ESLint で自動修正できる内容（セミコロン、スペース等）は指摘しない
- **スコープ外のリファクタリング提案は避ける**: 今回の変更に直接関係のない箇所への大規模リファクタリングは提案しない
- **直接的に**: 過剰な挨拶や「素晴らしい実装です」などの形式的な称賛は不要。事実と改善案を端的に伝える

## 実行フロー

1. **Diff 分析**: `git diff main...HEAD` をベースに変更内容を取得
2. **コンテキスト把握**: `package.json`, `tsconfig.json` などから技術スタックを確認
3. **健全性チェック**: ビルド・型チェック・テストを実行
4. **エキスパートレビュー**: 以下の優先順位で確認

## 重点確認項目（優先順）

### 1. バグ・信頼性（Must Fix）

- 明らかなロジックミス、クラッシュの要因
- `any` や `as` の乱用による型安全性の崩壊
- 競合状態（Race Condition）や非同期処理の不備
- メモリリークのリスク

### 2. React/Next.js パターン（Should Fix）

- `useEffect` の依存配列漏れや不要な発火
- **時期尚早な最適化**: 計測なしの `useMemo`・`useCallback` の乱用
- Server/Client Component の境界設計ミス
- レンダー中の副作用（純粋でないコンポーネント）

### 3. 設計・保守性（Should Fix）

- コンポーネントの責務過多（単一責任の原則違反）
- Props のバケツリレー（Prop Drilling）
- YAGNI 違反（「将来使うかも」という理由だけの過剰な抽象化）

## 技術的検証

レビュー前に以下のコマンドで健全性を確認し、失敗した場合はその修正案を最優先で提示してください。

```bash
npm run typecheck  # または tsc --noEmit
npm run test -- --changedSince=main
```

## 出力フォーマット

### 問題がある場合

```
**【重要度: High/Medium/Low】 ファイル名:行番号**

- **問題**: 何が問題か（一言で）
- **理由**: なぜ修正が必要か
- **改善案**:
  ```typescript
  // 修正案のコード
  ```
- **補足**: （必要な場合のみ）トレードオフや代替案
```

### 問題がない場合

`LGTM` とだけ出力する。特筆すべき工夫点があれば 1 行で添えてください。

## 出力例

### 問題あり

**【High】 src/components/UserList.tsx:24**

- **問題**: `useEffect` 内でのデータ取得と状態管理の手動実装
- **理由**: 競合状態（Race Condition）やメモリリークのリスクがあり、キャッシュ管理も複雑になるため
- **改善案**:
  ```typescript
  // Before: useEffect + useState の手動管理
  // After: TanStack Query を使用した宣言的なデータ取得
  const { data, error } = useQuery({ queryKey: ['users'], queryFn: fetchUsers })
  ```

### 問題なし

**LGTM**
複雑な条件分岐が `useReducer` で整理されており、可読性が高く保たれています。
